---
title: "West Side Aphid Whitefly 2022"
output: html_document
date: '2022-12-16'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(readxl)

WSAphWf2022.1 <-read_excel ("C:/Users/bachhami/Box Sync/UCDavis_Buddhi/spraydroplet_analysis/droplet_size_2/westside_aphid_wf2022/West_Side_Aphid_Wf_data2022.forR.xlsx") 

library(dplyr)
WSAphWf2022.1 <- mutate(WSAphWf2022.1, Date = as.Date(Date, origin = "15/8/2022"))

head (WSAphWf2022.1)

WSAphWf2022 <- WSAphWf2022.1 %>%
  filter (DAT %in% c("20-DAT-2","14-DAT-2", "7-DAT-2","2-DAT-2","13","7","2"))

head (WSAphWf2022)
```
```{r}
WSAphWf2022$DAT<-as.factor(WSAphWf2022$DAT) 
WSAphWf2022$TRT<-as.factor(WSAphWf2022$TRT)
WSAphWf2022$Product<-as.factor(WSAphWf2022$Product)
WSAphWf2022$Block<-as.factor(WSAphWf2022$Block)
```

```{r}
library(dplyr)

WSAphWf2022 %>%
  mutate(DAT2 = case_when(
    DAT == '0' ~ '0',
    DAT =='2' ~ '2', 
    DAT == '7' ~ '7',
    DAT == '13' ~ '13',
    DAT == '2-DAT-2' ~ '2DAT2',
    DAT == '7-DAT-2' ~ '7DAT2',
    DAT == '14-DAT-2' ~ '14DAT2',
    DAT == '20-DAT-2' ~ '20DAT2'))


head (WSAphWf2022)
tail (WSAphWf2022)
```

```{r}
library(plyr)
#summary whitefly
summaryWf<- ddply(WSAphWf2022, c("DAT","Product","TRT"), summarise,
                  N2    = sum(!is.na(Total_WFnymph_per_leaf)),
                  WfNym.Mean = mean(Total_WFnymph_per_leaf, na.rm=TRUE),
                  WfNymSD   = sd(Total_WFnymph_per_leaf, na.rm=TRUE),
                  WfNySE   = WfNymSD / sqrt(N2),
                  WfNy.Sum = sum(Total_WFnymph_per_leaf, na.rm=TRUE),
                  
                  N3    = sum(!is.na(WF_adult_per_leaf)),
                  WfAd.Mean = mean(WF_adult_per_leaf, na.rm=TRUE),
                  WfAdSD   = sd(WF_adult_per_leaf, na.rm=TRUE),
                  WfAdSE   = WfAdSD / sqrt(N3),
                  WfAd.Sum = sum(WF_adult_per_leaf, na.rm=TRUE))

summaryWf


## Whitefly after treatment
SummedWF<- ddply(WSAphWf2022, c("Product","TRT","Block"), summarise,
                 WfNym.Sum = sum(Total_WFnymph_per_leaf, na.rm=TRUE),
                 WfAd.Sum = sum(WF_adult_per_leaf, na.rm=TRUE))


SummedWF

SummedWF.Avg<- ddply(SummedWF, c("Product","TRT"), summarise,
                     N = sum(!is.na(WfNym.Sum)),
                     WfNym.SumAvg = mean(WfNym.Sum, na.rm=TRUE),
                     WfNym.SumSD   = sd(WfNym.Sum, na.rm=TRUE),
                     WfNym.SumSE   = WfNym.SumSD / sqrt(N),
                     WfAd.SumAvg = mean(WfAd.Sum, na.rm=TRUE),
                     WfAd.SumSD   = sd(WfAd.Sum, na.rm=TRUE),
                     WfAd.SumSE   = WfAd.SumSD / sqrt(N) ) 

SummedWF.Avg
```

```{r}
### Whitefly summary graphs
#### ALL dates

WFNymChart <- summaryWf %>%
  mutate (DAT = fct_relevel(DAT, "20-DAT-2","14-DAT-2", "7-DAT-2","2-DAT-2","13","7","2")) %>%
  ggplot(aes(fill=DAT,y=WfNym.Mean, x=Product))+
  geom_bar(position="stack",stat="identity")+ 
  scale_fill_manual("DAT", values = c("20-DAT-2" = "black","14-DAT-2" = "orange", "7-DAT-2" = "blue","2-DAT-2" = "lightgreen","13" = "red","7" = "purple","2" = "grey")) + 
  theme_bw()+
  theme(axis.text.x=element_text(angle=90)) 
  
WFNymChart
```

```{r}
WFAdChart <- summaryWf %>%
  mutate (DAT = fct_relevel(DAT, "20-DAT-2","14-DAT-2", "7-DAT-2","2-DAT-2","13","7","2")) %>%
  ggplot(aes(fill=DAT,y=WfAd.Mean, x=Product))+
  geom_bar(position="stack",stat="identity")+ 
  scale_fill_manual("DAT", values = c("20-DAT-2" = "black","14-DAT-2" = "orange", "7-DAT-2" = "blue","2-DAT-2" = "lightgreen","13" = "red","7" = "purple","2" = "grey")) + 
  theme_bw()+
  theme(axis.text.x=element_text(angle=90)) 

WFAdChart
```

```{r}
library(plyr)
#summary aphid
summary_T_aphid<- ddply(WSAphWf2022, c("DAT","Product","TRT"), summarise,
                  N4    = sum(!is.na(Total_Aphid_pre_leaf)),
                  TAphid.Mean = mean(Total_Aphid_pre_leaf, na.rm=TRUE),
                  TAphidSD   = sd(Total_Aphid_pre_leaf, na.rm=TRUE),
                  TAphidSE   = TAphidSD / sqrt(N4),
                  TAphid.Sum = sum(Total_Aphid_pre_leaf, na.rm=TRUE))
                  
                  
summary_T_aphid


## Total Aphid after treatment
SummedTAphid<- ddply(WSAphWf2022, c("Product","TRT","Block"), summarise,
                 TAphid.Sum = sum(Total_Aphid_pre_leaf, na.rm=TRUE)
                 )


SummedTAphid

SummedTAphid.Avg<- ddply(SummedTAphid, c("Product","TRT"), summarise,
                     N = sum(!is.na(TAphid.Sum)),
                     TAphid.SumAvg = mean(TAphid.Sum, na.rm=TRUE),
                     TAphid.SumSD   = sd(TAphid.Sum, na.rm=TRUE),
                     TAphid.SumSE   =  TAphid.SumSD / sqrt(N)
                     ) 

SummedTAphid.Avg
```

```{r}
#Total Aphid chart
TAphidhart <- summary_T_aphid %>%
  mutate (DAT = fct_relevel(DAT, "20-DAT-2","14-DAT-2", "7-DAT-2","2-DAT-2","13","7","2")) %>%
  ggplot(aes(fill=DAT,y=TAphid.Mean, x=Product))+
  geom_bar(position="stack",stat="identity")+ 
  scale_fill_manual("DAT", values = c("20-DAT-2" = "black","14-DAT-2" = "orange", "7-DAT-2" = "blue","2-DAT-2" = "lightgreen","13" = "red","7" = "purple","2" = "grey")) + 
  theme_bw()+
  theme(axis.text.x=element_text(angle=90)) 

TAphidhart
```

```{r}
# For DPR 
# Selecting Sefina, pqz, sivanto, assail, untreated

#WF nymphs

WFNymChart_dpr <- summaryWf %>%
  filter (TRT %in% c("1", "2", "4", "6", "11", "12", "14", "16", "17"))%>%
  mutate (DAT = fct_relevel(DAT, "20-DAT-2","14-DAT-2", "7-DAT-2","2-DAT-2","13","7","2")) %>%
  ggplot(aes(fill=DAT,y=WfNym.Mean, x=Product))+
  geom_bar(position="stack",stat="identity")+ 
  scale_fill_manual("DAT", values = c("20-DAT-2" = "black","14-DAT-2" = "orange", "7-DAT-2" = "blue","2-DAT-2" = "lightgreen","13" = "red","7" = "purple","2" = "grey")) + 
  theme_bw()+
  theme(axis.text.x=element_text(angle=90)) 
  
WFNymChart_dpr
```

```{r}
# For DPR 
# Selecting Sefina, pqz, sivanto, assail, untreated
# whitefly adult
 
WFAdChart_dpr <- summaryWf %>%
  filter (TRT %in% c("1", "2", "4", "6", "11", "12", "14", "16", "17"))%>%
  mutate (DAT = fct_relevel(DAT, "20-DAT-2","14-DAT-2", "7-DAT-2","2-DAT-2","13","7","2")) %>%
  ggplot(aes(fill=DAT,y=WfAd.Mean, x=Product))+
  geom_bar(position="stack",stat="identity")+ 
  geom_bar(position="stack",stat="identity",color="#333333",size=.1)+
  scale_fill_brewer(palette = "Spectral")+
  theme_classic()+
  theme(axis.text.x=element_text(angle=50, hjust=0.99))+
  theme(text=element_text(size=15))+labs(fill = "DAT")+
  theme(axis.text.x=element_text(color="#000000", size=12),
        axis.text.y=element_text(color="#000000", size=12))+
  ylab("Avg. whitefly nymphs (per leaf)")+
  xlab("")

WFAdChart_dpr 
```


```{r, include=TRUE,echo=TRUE,warning=FALSE, fig.dim = c(8, 6)}
# For DPR 
# Selecting Sefina, pqz, sivanto, assail, untreated 

TAphidhart_dpr <- summary_T_aphid %>%
  select ("DAT", "Product", "TAphid.Mean", "TRT")%>%
  filter (TRT %in% c("1", "2", "4", "6", "11", "12", "14", "16", "17"))%>%
  mutate (DAT = fct_relevel(DAT, "20-DAT-2","14-DAT-2", "7-DAT-2","2-DAT-2","13","7","2")) %>%
  ggplot(aes(fill=DAT,y=TAphid.Mean, x=Product))+
  geom_bar(position="stack",stat="identity",color="#333333",size=.1)+
    scale_fill_brewer(palette = "Spectral")+
  theme_classic()+
  theme(axis.text.x=element_text(angle=50, hjust=0.99))+
  theme(text=element_text(size=15))+labs(fill = "DAT")+
  theme(axis.text.x=element_text(color="#000000", size=12),
        axis.text.y=element_text(color="#000000", size=12))+
  ylab("Avg. Aphids (per leaf)")+
  xlab("")
TAphidhart_dpr
```


